---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.14.1
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---

# Inspection of distance datasets

```{python}
import pandas as pd
import os
from matplotlib import pyplot as plt
import numpy as np
```

```{python}
data_dir = '***'
data_dir2 = '***'
df = pd.read_csv(data_dir + '/distances.csv')
df2 = pd.read_csv(data_dir2 + '/distances.csv')
```

## General distribution inspection

```{python}
plt.figure()
plt.subplot(2, 1, 1)
plt.scatter(range(len(df)), df.standard_dist)
plt.subplot(2, 1, 2)
plt.scatter(range(len(df2)), df2.standard_dist)
plt.show()
```

```{python}
plt.figure()
plt.subplot(3, 1, 1)
df.Distance.plot.kde()
df2.Distance.plot.kde()
plt.legend(['ds1', 'ds2'])
#plt.axvline(x=0, color='red')
plt.subplot(3, 1, 2)
df.Distance.plot.kde()
plt.subplot(3, 1, 3)
df2.Distance.plot.kde()
plt.show()
```

```{python}
print(f"Min: {df.standard_dist.min()}; Mean: {df.standard_dist.mean()}; Max: {df.standard_dist.max()}")
print(f"Min: {df.Distance.min()}; Mean: {df.Distance.mean()}; Max: {df.Distance.max()}")
```

```{python}
print(f"Min: {df2.standard_dist.min()}; Mean: {df2.standard_dist.mean()}; Max: {df2.standard_dist.max()}")
print(f"Min: {df2.Distance.min()}; Mean: {df2.Distance.mean()}; Max: {df2.Distance.max()}")
```

## Image attributes

```{python}
plt.figure()
plt.subplot(2, 1, 1)
df.contrast.plot.density()
df.saturation.plot.density()
df.max_val.plot.density()
plt.legend(['conrast', 'saturation', 'brightness'])
plt.subplot(2, 1, 2)
df2.contrast.plot.density()
df2.saturation.plot.density()
df2.max_val.plot.density()
plt.legend(['conrast', 'saturation', 'brightness'])
plt.show()
```

## Check split distributions

```{python}
distances = df.Distance.values
```

```{python}
split = (.72, .18, .1)
abs_split = list(np.floor(np.array(split)[:2] * len(distances)).astype(np.int32))
abs_split.append(len(distances) - np.sum(abs_split))
```

```{python}
abs_split
```

```{python}
train = df.Distance[:abs_split[0]]
val = df.Distance[abs_split[0] : abs_split[0] + abs_split[1]]
test = df.Distance[abs_split[0] + abs_split[1]:]
```

```{python}
df_shuffled = df.sample(frac=1)
train_shuffled = df_shuffled.Distance[:abs_split[0]]
val_shuffled = df_shuffled.Distance[abs_split[0] : abs_split[0] + abs_split[1]]
test_shuffled = df_shuffled.Distance[abs_split[0] + abs_split[1]:]
```

```{python}
plt.figure()
plt.subplot(2, 1, 1)
plt.title("Distance distribution in splits before and after shuffling the whole dataset")
train.plot.kde()
val.plot.kde()
test.plot.kde()
plt.legend(['train', 'val', 'test'])
plt.axvline(x=5, color='red')
plt.subplot(2, 1, 2)
train_shuffled.plot.kde()
val_shuffled.plot.kde()
test_shuffled.plot.kde()
plt.legend(['train', 'val', 'test'])
plt.axvline(x=5, color='red')
plt.show()
```

```{python}
distances2 = df2.Distance.values
```

```{python}
split = (.72, .18, .1)
abs_split2 = list(np.floor(np.array(split)[:2] * len(distances2)).astype(np.int32))
abs_split.append(len(distances2) - np.sum(abs_split2))
```

```{python}
abs_split2
```

```{python}
train2 = df2.Distance[:abs_split2[0]]
val2 = df2.Distance[abs_split2[0] : abs_split2[0] + abs_split2[1]]
test2 = df2.Distance[abs_split2[0] + abs_split2[1]:]
```

```{python}
df_shuffled2 = df2.sample(frac=1)
train_shuffled2 = df_shuffled2.Distance[:abs_split2[0]]
val_shuffled2 = df_shuffled2.Distance[abs_split2[0] : abs_split2[0] + abs_split2[1]]
test_shuffled2 = df_shuffled2.Distance[abs_split2[0] + abs_split2[1]:]
```

```{python}
plt.figure()
plt.subplot(2, 1, 1)
plt.title("Distance distribution in splits before and after shuffling the whole dataset (2)")
train2.plot.kde()
val2.plot.kde()
test2.plot.kde()
plt.legend(['train', 'val', 'test'])
plt.axvline(x=5, color='red')
plt.subplot(2, 1, 2)
train_shuffled2.plot.kde()
val_shuffled2.plot.kde()
test_shuffled2.plot.kde()
plt.legend(['train', 'val', 'test'])
plt.axvline(x=5, color='red')
plt.show()
```

## Outlier detection
The outlier detection is done with the z-test based on the median.

```{python}
df['Dist_z'] = np.abs(df.Distance - df.Distance.median()) / df.Distance.std()

outliers = df[df.Dist_z > 3.5]
print(f"We have {len(outliers)} outliers. That is {len(outliers) / len(df) * 100}% of the dataset.")
```

```{python}
df2['Dist_z'] = np.abs(df2.Distance - df2.Distance.median()) / df2.Distance.std()

outliers2 = df2[df2.Dist_z > 3.5]
print(f"We have {len(outliers2)} outliers. That is {len(outliers2) / len(df2) * 100}% of the dataset.")
```

```{python}

```
